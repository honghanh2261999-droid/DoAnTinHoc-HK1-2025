import csv
import os

# Xác định đường dẫn gốc của dự án
PROJECT_ROOT = os.path.dirname(__file__)
DATA_FILE = os.path.join(PROJECT_ROOT, 'data', 'healthcare-dataset.csv')
OUTPUT_FILE = os.path.join(PROJECT_ROOT, 'data', 'healthcare_output.csv')

# Hàm đọc toàn bộ file CSV
def read_csv_file(path):
    """Đọc toàn bộ file CSV bằng csv.DictReader."""
    with open(path, mode='r', encoding='utf-8', newline='') as csvfile:
        reader = csv.DictReader(csvfile)
        rows = [row for row in reader]
    print(f"Đã đọc {len(rows)} dòng từ {path}")
    return rows

# Hàm ghi dữ liệu ra file CSV mới
def write_csv_file(path, rows, fieldnames):
    """Ghi các hàng dữ liệu ra file CSV bằng csv.DictWriter."""
    with open(path, mode='w', encoding='utf-8', newline='') as csvfile:
        writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
        writer.writeheader()
        for row in rows:
            writer.writerow(row)
    print(f"Đã ghi {len(rows)} dòng vào {path}")

# Hàm chính
def main():
    if not os.path.exists(DATA_FILE):
        raise FileNotFoundError(f"Không tìm thấy file dữ liệu: {DATA_FILE}")
    
    rows = read_csv_file(DATA_FILE)
    processed_rows = rows  # có thể xử lý thêm nếu cần
    
    if processed_rows:
        fieldnames = list(processed_rows[0].keys())
    else:
        fieldnames = []
    
    write_csv_file(OUTPUT_FILE, processed_rows, fieldnames)

# Điểm bắt đầu chương trình
if __name__ == '__main__':
    main()
